version: '3'

services:
  app:
    container_name: server
    build:
      context: "./server"
      dockerfile: Dockerfile
    ports:
      - "81:81"
      - "8001:8001"
    volumes:
      - type: bind
        source: ./server
        target: /app
    command: sh -c '/app/app/wait_for_it.sh mysql:3306 && /start-reload.sh'
    environment:
      - MYSQL_ROOT_PASSWORD=test
      - MYSQL_USER=test
      - MYSQL_PASSWORD=test
      - MYSQL_DATABASE=invest_test
    networks:
      - backend
    depends_on:
      - mysql

  mysql:
    image: mysql:8
    container_name: mysql
    hostname: mysql
    environment:
      - MYSQL_ROOT_PASSWORD=test
      - MYSQL_USER=test
      - MYSQL_PASSWORD=test
      - MYSQL_DATABASE=invest_test
    networks:
      - backend

  react-app:
    build:
      context: "./client"
      dockerfile: Dockerfile
    container_name: react-app  
    stdin_open: true
    ports: 
      - "3000:3000"
    networks:
      - client      
    environment:
      CHOKIDAR_USEPOLLING: "true"  
    volumes:
      - type: bind
        source: ./client
        target: /app    

networks:
  backend:
    driver: bridge
  client:
    driver: bridge   